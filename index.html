<html lang="en"><head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta charset="utf-8">
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <title>Y4E</title>
</head>
<body style="background-image: url(pic/natural.jpg); background-size: cover; background-attachment: fixed; height: 200%;">

  <!-- NAVBAR -->
  <nav class="white">
    <div class="nav-wrapper container">
      <a href="#" class="brand-logo brown-text"><i class="material-icons green-text">filter_hdr</i>Y4E</a>
      <ul id="nav-mobile" class="right hide-on-med-and-down">
          <li class="logged-in" style="display: none;">
            <a href="index.html" class="brown-text" id="homepage">Home</a>
          </li>
          <li class="logged-in" style="display: none;">
            <a href="#" class="brown-text modal-trigger" data-target="modal-account">Account</a>
          </li>
          <li class="logged-in" style="display: none;">
            <a href="goyoga.html" class="brown-text" id="goYoga">Yoga</a>
          </li>
          <li class="logged-in" style="display: none; padding-top: 3%;">
            <button class="button-18" role="button">
               <a href="index.html" class="white-text" id="logout">Logout</a>
            </button>
          </li>
          <li class="logged-out" style="display: none;">
            <a href="#" class="brown-text modal-trigger" data-target="modal-login">Login</a>
          </li>
          <li class="logged-out" style="display: none;">
            <a href="#" class="brown-text modal-trigger" data-target="modal-signup">Sign up</a>
          </li>
      </ul>
    </div>
  </nav>

  <!-- SIGN UP MODAL -->
  <div id="modal-signup" class="modal">
    <div class="modal-content">
      <h4>Sign up</h4><br>
      <form id="signup-form">
        <div class="input-field">
          <input type="email" id="signup-email" required="">
          <label for="signup-email">Email address</label>
        </div>
        <div class="input-field">
          <input type="password" id="signup-password" required="">
          <label for="signup-password">Password</label>
        </div>
        <div class="input-field">
          <input type="text" id="signup-username" required="">
          <label for="signup-username">Username</label>
        </div>
        <button class="btn brown darken-3 z-depth-0">Sign up</button>
      </form>
    </div>
  </div>

  <!-- LOGIN MODAL -->
  <div id="modal-login" class="modal">
    <div class="modal-content">
      <h4>Login</h4><br>
      <form id="login-form">
        <div class="input-field">
          <input type="email" id="login-email" required="">
          <label for="login-email">Email address</label>
        </div>
        <div class="input-field">
          <input type="password" id="login-password" required="">
          <label for="login-password">Your password</label>
        </div>
        <button class="btn brown darken-3 z-depth-0">Login</button>
      </form>
    </div>
  </div>

  <!-- ACCOUNT MODAL -->
  <div id="modal-account" class="modal">
    <div class="modal-content center-align">
      <h4>Account details</h4><br>
      <div class="account-details" ></div>
    </div>
  </div>
  
  <!-- Home Login -->
  <li class="logged-in" style="display: none; ">
    <img src="pic/banner.png" alt="" class="responsive">
  
  <div class="tabcontrol">
  <div class="container-tab">
    <div class="content">
      <input type="radio" name="slider" checked id="rank">
      <input type="radio" name="slider" id="histo">
      <input type="radio" name="slider" id="graph">
      
      <div class="list">
        <label for="rank" class="rank">
        <i class="material-icons brown-text">filter_1</i>
        <span class="title">Ranking</span>
      </label>
      <label for="histo" class="histo">
        <i class="material-icons brown-text">access_time</i>
        <span class="title">History</span>
      </label>
      <label for="graph" class="graph">
        <i class="material-icons brown-text">equalizer</i>
        <span class="title">Progress</span>
      </label>
      
      <div class="slider"></div>
    </div>
      <div class="text-content">
        <div class="rank text">
          <p>username:</p><p class="username" id="username" style="position:absolute; top: 392px; left: 500px"></p>
          <p>points :</p><div class="total-burnedcal" id="total-burnedcal" style="position:absolute; top: 443px; left: 500px"></div>
          
          <table class="content-table">
            <thead>
              <tr>
                <th>username</th>
                <th>total points</th>
              </tr>
            </thead>
            <tbody id="tbody1">
              <tr>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="histo text">
              
              <div class="container">
                <table class="content-table2">
                  <thead>
                    <tr>
                      <th>date</th>
                      <th>points</th>
                      <th>time</th>
                      <th>type</th>
                    </tr>
                  </thead>
                  <tbody id="tbody2">
                    <tr>
                    </tr>
                  </tbody>
                </table>
              </div>
        </div>
        <div class="graph text">
          <canvas id="myChart" width="100" height="50"></canvas> 
        </div>
      </div>
    </div>
  </div>
</div>
  
  <!-- Home Not Login -->
  <li class="logged-out" style="display: none;">
  <div class="container" style="margin-top: 40px;">
    <p>Not Login</p>
  </div>
  </li>
  
  
  <script src="firebase-app.js"></script>
  <script src="firebase-auth.js"></script>
  <script src="firebase-firestore.js"></script>
  <script>
    // Initialize Firebase
    var config = {
      apiKey: "AIzaSyBh_vKw1eozno1VVGaedDXgTJhNljWfUvk",
    authDomain: "yoga-data-51fbc.firebaseapp.com",
    projectId: "yoga-data-51fbc",
    storageBucket: "yoga-data-51fbc.appspot.com",
    messagingSenderId: "661341190469",
    appId: "1:661341190469:web:d99092212b6e577679e62c",
    measurementId: "G-GMZ0T8EJ1M"
    };
    firebase.initializeApp(config);
    
    // make auth and firestore references
    const auth = firebase.auth();
    const db = firebase.firestore();

    // update firestore settings
    db.settings({ timestampsInSnapshots: true });
  </script>
  

    <!-- Compiled and minified JavaScript -->
  <script src="scripts/auth.js"></script>
  <script src="scripts/index.js"></script>
  <script src ="sketch.js"></script>
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <!-- Compiled and minified CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

  <!-- Compiled and minified JavaScript -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3"></script>
  <script>
    $(document).ready(function(){

      $('.sidenav').sidenav();
      $('.materialboxed').materialbox();
      $('.parallax').parallax();
      $('.tabs').tabs();

    });
  </script>

  <!-- Ranking Table Record -->
  <script>
    function SelectData (){
      db.collection('users').orderBy("burnedcal","desc").get().then((snapshot) => {
        snapshot.docs.forEach(doc => {
          var name = doc.data().username;
          var calb = doc.data().burnedcal;
          AddItemsToTable(name,calb);
        })
      });
    }
    SelectData();

    var userNo = 0;
    function AddItemsToTable(name,calb){
      var tbody = document.getElementById('tbody1');
      var trow = document.createElement('tr');
      var td1 = document.createElement('td');
      var td2 = document.createElement('td');
      td1.innerHTML = name;
      td2.innerHTML = calb;
      trow.appendChild(td1); 
      trow.appendChild(td2);
      tbody.appendChild(trow);
    }    
  </script>

  <!-- Table History Exercises -->
  <script>
    userid = JSON.parse(localStorage.getItem('userid')).userid
    function SelectData2 (){
      db.collection('exercise').doc(userid).collection('round').orderBy("daydate","desc").get().then((snapshot2) => {
        snapshot2.docs.forEach(doc => {
          var dday = doc.data().daydate;
          var pcal = doc.data().pcalories;
          var timep = doc.data().time;
          var typep = doc.data().type;
          AddItemsToTable2(dday,pcal,timep,typep);
        })
      });
    }
    SelectData2();

    function AddItemsToTable2(dday,pcal,timep,typep){
      var tbody2 = document.getElementById('tbody2');
      var trow2 = document.createElement('tr');
      var td12 = document.createElement('td');
      var td22 = document.createElement('td');
      var td32 = document.createElement('td');
      var td42 = document.createElement('td');
      td12.innerHTML = dday;
      td22.innerHTML = pcal;
      td32.innerHTML = timep;
      td42.innerHTML = typep;
      trow2.appendChild(td12); 
      trow2.appendChild(td22);
      trow2.appendChild(td32);
      trow2.appendChild(td42);
      tbody2.appendChild(trow2);
    }    
  </script>

  <!-- Chart -->
  <script>
    

    var itemArray = [];
    db.collection('exercise').doc(userid).collection('round').get().then((snapshot) => {
        snapshot.docs.forEach(doc => {
            var item = doc.data();
            itemArray.push(item);
        });   
        
        let result = itemArray.reduce((acc, curr) => {
            let item = acc.find(item => item.daydate === curr.daydate);

            if (item) {
              item.pcalories += curr.pcalories;
            } else {
              acc.push(curr);
            }

            return acc;
          }, []);
          console.log(result);
          result.sort(function(a,b){
            return new Date(b.daydate) - new Date(a.daydate);
          });
          let day = [];
          let calo = [];
          
          for (let i in result){
            day.push(result[i].daydate);
            calo.push(result[i].pcalories);
          }

          const ctx = document.getElementById('myChart').getContext('2d');
          const xlabels =[];
          const myChart = new Chart(ctx, {
              type: 'bar',
              data: {
                  labels: day,
                  datasets: [{
                      label: 'points',
                      data: calo,
                      backgroundColor: 'rgba(121, 157, 91, 0.8)',
                      borderColor: 'rgba(255, 255, 255, 0.2)',
                      borderWidth: 1
                  }]
              },
              options: {
                  scales: {
                      yAxes: [{
                          ticks: {
                              beginAtZero: true
                          }
                      }]
                  }
              }
          });
    });
  </script> 

</body></html>